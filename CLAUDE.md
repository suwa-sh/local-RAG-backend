# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリでコードを扱う際のガイダンスを提供します。

## ■プロジェクトコンセプト

@README.md を参照してください。

## ■コミュニケーションルール

- 日本語で会話してください
- 進め方を計画してユーザーと認識を合わせてから、実装を進めてください
- ファイルの文字コードはUTF-8を使用してください
- 現在の作業状況は @tmp/active_context.md に記録してください
- 動作確認などに必要な一時的なファイルは tmp/ ディレクトリ配下に出力してください

### 重要

- bugfixでユーザーとやり取りする内容はサンプルです。*決してハードコーディングしないでください*

## ■開発ルール

- 進め方
  - 設計 -> ユーザーと仕様を認識合わせ -> TDDで実装を進める
- 設計方針
  - C4モデルで構造を整理
  - USMでユースケースを整理
  - ユースケースごとにドメインモデリング
    - ドメインモデル図: 具体的な値をオブジェクト図で表現
    - クラス図: ドメインモデルのクラス構造を表現
  - DDDに従う
- レイヤー構造
  - プレゼンテーション層: src/main/
  - ユースケース層: src/usecase/
  - ドメイン層: src/domain/
  - リポジトリ層: src/repository/
  - アダプター層: src/adapter/
- 開発支援
  - rye: パッケージ管理と仮想環境の構築
  - pytest: テストフレームワーク
  - qlty: コード品質チェックツール(linter, formatter, static analyzer)
- 決定した内容は @DEVELOPPER.md に記録してください

## ■テストコードのルール

テストコードは以下のルールに従って作成してください：

### テストメソッド命名規則
テスト名と内容はBDDに倣って、「〜の場合、〜であること」という形式で、ビジネス要件を明確に表現してください。

```
test_{対象機能}_{テスト条件}_{期待結果}であること
```

**例：**
```python
def test_models_endpoint_GETリクエストを送信した場合_claude_sonnet_4だけが返されること(self, server_process):
def test_chat_completion_正常なチャットリクエストを送信した場合_回答が得られること(self, server_process, client):
def test_chat_completion_チャットリクエストで無効なAPIキーでリクエストを送信した場合_例外が発生すること(self, server_process):
```

### AAAパターンの実装
すべてのテストメソッドは以下の3つのセクションに明確に分割してください：

- **準備 (Arrange)**: テストに必要なデータ、オブジェクト、モックを設定
- **実行 (Act)**: テスト対象の機能を実行（1つの操作に集中）
- **検証 (Assert)**: 期待される結果と実際の結果を比較・検証

```python
def test_example_テスト条件_期待結果であること(self, fixtures):
    #------------------------------
    # 準備 (Arrange)
    #------------------------------
    # テストデータの設定、モックの準備など
    
    #------------------------------
    # 実行 (Act)
    #------------------------------
    # テスト対象の機能を実行
    
    #------------------------------
    # 検証 (Assert)
    #------------------------------
    # 結果の検証とアサーション
```

### テストケースの焦点
- 各テストメソッドは1つの具体的なシナリオに集中する
- 複雑な並行処理や複数の条件を組み合わせたテストは避ける
- 基本的な動作確認を重視し、エッジケースは別のテストで扱う
